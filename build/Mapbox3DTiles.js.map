{"version":3,"file":"Mapbox3DTiles.js","sources":["../src/Utils.js","../src/Mapbox3DTiles.js","../index.js"],"sourcesContent":["export class Utils {\n    static loadSkybox (path) {\n\t\tlet camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 100000);\n\t\tcamera.up.set(0, 0, 1);\n\t\tlet scene = new THREE.Scene();\n        \n        const shader = THREE.ShaderLib.equirect;\n        const material = new THREE.ShaderMaterial({\n            fragmentShader: shader.fragmentShader,\n            vertexShader: shader.vertexShader,\n            uniforms: shader.uniforms,\n            depthWrite: false,\n            side: THREE.BackSide,\n        });\n\n        let loader = new THREE.TextureLoader();\n        loader.load('https://threejsfundamentals.org/threejs/resources/images/equirectangularmaps/tears_of_steel_bridge_2k.jpg',\n            function loaded (texture) {\n                texture.magFilter = THREE.LinearFilter;\n                texture.minFilter = THREE.LinearFilter;\n                material.uniforms.tEquirect.value = texture;\n            }, function progress (xhr) {\n                // console.log( (xhr.loaded / xhr.total * 100) + '% loaded' );\n            }, function error (xhr) {\n                console.log('An error happened', xhr);\n            }\n        );\n\t\t\n\n\t\tlet skyGeometry = new THREE.BoxBufferGeometry(5000, 5000, 5000);\n\t\tlet skybox = new THREE.Mesh(skyGeometry, material);\n\n\t\tscene.add(skybox);\n\n\t\t// z up\n\t\tscene.rotation.x = Math.PI / 2;\n\n\t\treturn {'camera': camera, 'scene': scene};\n    };\n}","import { Utils } from './Utils.js';\nexport default function Mapbox3DTiles() {\n\t\n\tconst WEBMERCATOR_EXTENT = 20037508.3427892;\n\tconst THREE = window.THREE;\n\tconst DEBUG = false;\t\n\n\n\tclass TileSet {\n\t\tconstructor(){\n\t\t\tthis.url = null;\n\t\t\tthis.version = null;\n\t\t\tthis.gltfUpAxis = 'Z';\n\t\t\tthis.geometricError = null;\n\t\t\tthis.root = null;\n\t\t}\n\t\tload(url, styleParams) {\n\t\t\tthis.url = url;\n\t\t\tlet resourcePath = THREE.LoaderUtils.extractUrlBase(url);\n\t\t\tlet self = this;\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tfetch(self.url)\n\t\t\t\t\t.then(response => {\n\t\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\t\tthrow new Error(`HTTP ${response.status} - ${response.statusText}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn response;\n\t\t\t\t\t})\n\t\t\t\t\t.then(response => response.json())\n\t\t\t\t\t.then(json => {\n\t\t\t\t\t\tself.version = json.asset.version;\n\t\t\t\t\t\tself.geometricError = json.geometricError;\n\t\t\t\t\t\tself.refine = json.refine ? json.refine.toUpperCase() : 'ADD';\n\t\t\t\t\t\tself.root = new ThreeDeeTile(json.root, resourcePath, styleParams, self.refine, true);\n\t\t\t\t\t})\n\t\t\t\t\t.then(res => resolve())\n\t\t\t\t\t.catch(error => {\n\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t});\n\t\t\t});\t\t\n\t\t}\n\t}\n\n\n\tclass ThreeDeeTile {\n\t\tconstructor(json, resourcePath, styleParams, parentRefine, isRoot) {\n\t\t\tthis.loaded = false;\n\t\t\tthis.styleParams = styleParams;\n\t\t\tthis.resourcePath = resourcePath;\n\t\t\tthis.totalContent = new THREE.Group();\t// Three JS Object3D Group for this tile and all its children\n\t\t\tthis.tileContent = new THREE.Group();\t\t// Three JS Object3D Group for this tile's content\n\t\t\tthis.childContent = new THREE.Group();\t\t// Three JS Object3D Group for this tile's children\n\t\t\tthis.totalContent.add(this.tileContent);\n\t\t\tthis.totalContent.add(this.childContent);\n\t\t\tthis.boundingVolume = json.boundingVolume;\n\t\t\tif (this.boundingVolume && this.boundingVolume.box) {\n\t\t\t\tlet b = this.boundingVolume.box;\n\t\t\t\tlet extent = [b[0] - b[3], b[1] - b[7], b[0] + b[3], b[1] + b[7]];\n\t\t\t\tlet sw = new THREE.Vector3(extent[0], extent[1], b[2] - b[11]);\n\t\t\t\tlet ne = new THREE.Vector3(extent[2], extent[3], b[2] + b[11]);\n\t\t\t\tthis.box = new THREE.Box3(sw, ne);\n\t\t\t\tif (DEBUG) {\n\t\t\t\t\tlet geom = new THREE.BoxGeometry(b[3] * 2, b[7] * 2, b[11] * 2);\n\t\t\t\t\tlet edges = new THREE.EdgesGeometry( geom );\n\t\t\t\t\tlet line = new THREE.LineSegments( edges, new THREE.LineBasicMaterial( { color: 0x800000 } ) );\n\t\t\t\t\tlet trans = new THREE.Matrix4().makeTranslation(b[0], b[1], b[2]);\n\t\t\t\t\tline.applyMatrix(trans);\n\t\t\t\t\tthis.totalContent.add(line);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.extent = null;\n\t\t\t\tthis.sw = null;\n\t\t\t\tthis.ne = null;\n\t\t\t\tthis.box = null;\n\t\t\t\tthis.center = null;\n\t\t\t}\n\t\t\tthis.refine = json.refine ? json.refine.toUpperCase() : parentRefine;\n\t\t\tthis.geometricError = json.geometricError;\n\t\t\tthis.transform = json.transform;\n\t\t\tif (this.transform && !isRoot) { \n\t\t\t\t// if not the root tile: apply the transform to the THREE js Group\n\t\t\t\t// the root tile transform is applied to the camera while rendering\n\t\t\t\tthis.totalContent.applyMatrix(new THREE.Matrix4().fromArray(this.transform));\n\t\t\t}\n\t\t\tthis.content = json.content;\n\t\t\tthis.children = [];\n\t\t\tif (json.children) {\n\t\t\t\tfor (let i=0; i<json.children.length; i++){\n\t\t\t\t\tlet child = new ThreeDeeTile(json.children[i], resourcePath, styleParams, this.refine, false);\n\t\t\t\t\tthis.childContent.add(child.totalContent);\n\t\t\t\t\tthis.children.push(child);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tload() {\n\t\t\tthis.tileContent.visible = true;\n\t\t\tthis.childContent.visible = true;\n\t\t\tif (this.loaded) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.loaded = true;\n\t\t\tlet self = this;\n\t\t\tif (this.content) {\n\t\t\t\tlet url = this.content.uri ? this.content.uri : this.content.url;\n\t\t\t\tif (!url) return;\n\t\t\t\tif (url.substr(0, 4) != 'http')\n\t\t\t\t\turl = this.resourcePath + url;\n\t\t\t\tlet type = url.slice(-4);\n\t\t\t\tif (type == 'json') {\n\t\t\t\t\t// child is a tileset json\n\t\t\t\t\tlet tileset = new TileSet();\n\t\t\t\t\ttileset.load(url, this.styleParams).then(function(){\n\t\t\t\t\t\tself.children.push(tileset.root);\n\t\t\t\t\t\tif (tileset.root) {\n\t\t\t\t\t\t\tif (tileset.root.transform) {\n\t\t\t\t\t\t\t\t// the root tile transform of a tileset is normally not applied because\n\t\t\t\t\t\t\t\t// it is applied by the camera while rendering. However, in case the tileset \n\t\t\t\t\t\t\t\t// is a subset of another tileset, so the root tile transform must be applied \n\t\t\t\t\t\t\t\t// to the THREE js group of the root tile.\n\t\t\t\t\t\t\t\ttileset.root.totalContent.applyMatrix(new THREE.Matrix4().fromArray(tileset.root.transform));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tself.childContent.add(tileset.root.totalContent);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else if (type == 'b3dm') {\n\t\t\t\t\tlet loader = new THREE.GLTFLoader();\n\t\t\t\t\tlet b3dm = new B3DM(url);\n\t\t\t\t\tlet rotateX = new THREE.Matrix4().makeRotationAxis(new THREE.Vector3(1, 0, 0), Math.PI / 2);\n\t\t\t\t\tself.tileContent.applyMatrix(rotateX); // convert from GLTF Y-up to Z-up\n\t\t\t\t\tb3dm.load()\n\t\t\t\t\t\t.then(d => loader.parse(d.glbData, self.resourcePath, function(gltf) {\n\t\t\t\t\t\t\t\tif (self.styleParams.color != null || self.styleParams.opacity != null) {\n\t\t\t\t\t\t\t\t\tlet color = new THREE.Color(self.styleParams.color);\n\t\t\t\t\t\t\t\t\tgltf.scene.traverse(child => {\n\t\t\t\t\t\t\t\t\t\tif (child instanceof THREE.Mesh) {\n\t\t\t\t\t\t\t\t\t\t\tif (self.styleParams.color != null) \n\t\t\t\t\t\t\t\t\t\t\t\tchild.material.color = color;\n\t\t\t\t\t\t\t\t\t\t\tif (self.styleParams.opacity != null) {\n\t\t\t\t\t\t\t\t\t\t\t\tchild.material.opacity = self.styleParams.opacity;\n\t\t\t\t\t\t\t\t\t\t\t\tchild.material.transparent = self.styleParams.opacity < 1.0 ? true : false;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t/*let children = gltf.scene.children;\n\t\t\t\t\t\t\t\tfor (let i=0; i<children.length; i++) {\n\t\t\t\t\t\t\t\t\tif (children[i].isObject3D) \n\t\t\t\t\t\t\t\t\t\tself.tileContent.add(children[i]);\n\t\t\t\t\t\t\t\t}*/\n\t\t\t\t\t\t\t\tself.tileContent.add(gltf.scene);\n\t\t\t\t\t\t\t}, function(e) {\n\t\t\t\t\t\t\t\tthrow new Error('error parsing gltf: ' + e);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t)\n\t\t\t\t} else if (type == 'pnts') {\n\t\t\t\t\tlet pnts = new PNTS(url);\n\t\t\t\t\tpnts.load()\n\t\t\t\t\t\t.then(d => {\n\t\t\t\t\t\t\tlet geometry = new THREE.BufferGeometry();\n\t\t\t\t\t\t\tgeometry.addAttribute('position', new THREE.Float32BufferAttribute(d.points, 3));\n\t\t\t\t\t\t\tlet material = new THREE.PointsMaterial();\n\t\t\t\t\t\t\tmaterial.size = self.styleParams.pointsize != null ? self.styleParams.pointsize : 1.0;\n\t\t\t\t\t\t\tif (self.styleParams.color) {\n\t\t\t\t\t\t\t\tmaterial.vertexColors = THREE.NoColors;\n\t\t\t\t\t\t\t\tmaterial.color = new THREE.Color(self.styleParams.color);\n\t\t\t\t\t\t\t\tmaterial.opacity = self.styleParams.opacity != null ? self.styleParams.opacity : 1.0;\n\t\t\t\t\t\t\t} else if (d.rgba) {\n\t\t\t\t\t\t\t\tgeometry.addAttribute('color', new THREE.Float32BufferAttribute(d.rgba, 4));\n\t\t\t\t\t\t\t\tmaterial.vertexColors = THREE.VertexColors;\n\t\t\t\t\t\t\t} else if (d.rgb) {\n\t\t\t\t\t\t\t\tgeometry.addAttribute('color', new THREE.Float32BufferAttribute(d.rgb, 3));\n\t\t\t\t\t\t\t\tmaterial.vertexColors = THREE.VertexColors;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tself.tileContent.add(new THREE.Points( geometry, material ));\n\t\t\t\t\t\t\tif (d.rtc_center) {\n\t\t\t\t\t\t\t\tlet c = d.rtc_center;\n\t\t\t\t\t\t\t\tself.tileContent.applyMatrix(new THREE.Matrix4().makeTranslation(c[0], c[1], c[2]));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tself.tileContent.add(new THREE.Points( geometry, material ));\n\t\t\t\t\t\t});\n\t\t\t\t} else if (type == 'i3dm') {\n\t\t\t\t\tthrow new Error('i3dm tiles not yet implemented');\t\t\t\t\t\n\t\t\t\t} else if (type == 'cmpt') {\n\t\t\t\t\tthrow new Error('cmpt tiles not yet implemented');\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error('invalid tile type: ' + type);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tunload(includeChildren) {\n\t\t\tthis.tileContent.visible = false;\n\t\t\tif (includeChildren) {\n\t\t\t\tthis.childContent.visible = false;\n\t\t\t} else  {\n\t\t\t\tthis.childContent.visible = true;\n\t\t\t}\n\t\t\t// TODO: should we also free up memory?\n\t\t}\n\t\tcheckLoad(frustum, cameraPosition) {\n\t\t\t// is this tile visible?\n\t\t\tif (!frustum.intersectsBox(this.box)) {\n\t\t\t\tthis.unload(true);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tlet dist = this.box.distanceToPoint(cameraPosition);\n\n\t\t\t//console.log(`dist: ${dist}, geometricError: ${this.geometricError}`);\n\t\t\t// are we too far to render this tile?\n\t\t\tif (this.geometricError > 0.0 && dist > this.geometricError * 50.0) {\n\t\t\t\tthis.unload(true);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\t// should we load this tile?\n\t\t\tif (this.refine == 'REPLACE' && dist < this.geometricError * 20.0) {\n\t\t\t\tthis.unload(false);\n\t\t\t} else {\n\t\t\t\tthis.load();\n\t\t\t}\n\n\t\t\t// should we load its children?\n\t\t\tfor (let i=0; i<this.children.length; i++) {\n\t\t\t\tif (dist < this.geometricError * 20.0) {\n\t\t\t\t\tthis.children[i].checkLoad(frustum, cameraPosition);\n\t\t\t\t} else {\n\t\t\t\t\tthis.children[i].unload(true);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t/*\n\t\t\t// below code loads tiles based on screenspace instead of geometricError,\n\t\t\t// not sure yet which algorith is better so i'm leaving this code here for now\n\t\t\tlet sw = this.box.min.clone().project(camera);\n\t\t\tlet ne = this.box.max.clone().project(camera);\t\t\t\n\t\t\tlet x1 = sw.x, x2 = ne.x;\n\t\t\tlet y1 = sw.y, y2 = ne.y;\n\t\t\tlet tilespace = Math.sqrt((x2 - x1)*(x2 - x1) + (y2 - y1)*(y2 - y1)); // distance in screen space\n\t\t\t\n\t\t\tif (tilespace < 0.2) {\n\t\t\t\tthis.unload();\n\t\t\t}\n\t\t\t// do nothing between 0.2 and 0.25 to avoid excessive tile loading/unloading\n\t\t\telse if (tilespace > 0.25) {\n\t\t\t\tthis.load();\n\t\t\t\tthis.children.forEach(child => {\n\t\t\t\t\tchild.checkLoad(camera);\n\t\t\t\t});\n\t\t\t}*/\n\t\t\t\n\t\t}\n\t}\n\n\tclass TileLoader {\n\t\t// This class contains the common code to load tile content, such as b3dm and pnts files.\n\t\t// It is not to be used directly. Instead, subclasses are used to implement specific \n\t\t// content loaders for different tile types.\n\t\tconstructor(url) {\n\t\t\tthis.url = url;\n\t\t\tthis.type = url.slice(-4);\n\t\t\tthis.version = null;\n\t\t\tthis.byteLength = null;\n\t\t\tthis.featureTableJSON = null;\n\t\t\tthis.featureTableBinary = null;\n\t\t\tthis.batchTableJson = null;\n\t\t\tthis.batchTableBinary = null;\n\t\t\tthis.binaryData = null;\n\t\t}\n\t\tload() {\n\t\t\tlet self = this;\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tfetch(self.url)\n\t\t\t\t\t.then(response => {\n\t\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\t\tthrow new Error(`HTTP ${response.status} - ${response.statusText}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn response;\n\t\t\t\t\t})\n\t\t\t\t\t.then(response => response.arrayBuffer())\n\t\t\t\t\t.then(buffer => self.parseResponse(buffer))\n\t\t\t\t\t.then(res => resolve(res))\n\t\t\t\t\t.catch(error => {\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t});\n\t\t\t});\t\t\n\t\t}\n\t\tparseResponse(buffer) {\n\t\t\tlet header = new Uint32Array(buffer.slice(0, 28));\n\t\t\tlet decoder = new TextDecoder();\n\t\t\tlet magic = decoder.decode(new Uint8Array(buffer.slice(0, 4)));\n\t\t\tif (magic != this.type) {\n\t\t\t\tthrow new Error(`Invalid magic string, expected '${this.type}', got '${this.magic}'`);\n\t\t\t}\n\t\t\tthis.version = header[1];\n\t\t\tthis.byteLength = header[2];\n\t\t\tlet featureTableJSONByteLength = header[3];\n\t\t\tlet featureTableBinaryByteLength = header[4];\n\t\t\tlet batchTableJsonByteLength = header[5];\n\t\t\tlet batchTableBinaryByteLength = header[6];\n\t\t\t\n\t\t\t/*\n\t\t\tconsole.log('magic: ' + magic);\n\t\t\tconsole.log('version: ' + this.version);\n\t\t\tconsole.log('featureTableJSONByteLength: ' + featureTableJSONByteLength);\n\t\t\tconsole.log('featureTableBinaryByteLength: ' + featureTableBinaryByteLength);\n\t\t\tconsole.log('batchTableJsonByteLength: ' + batchTableJsonByteLength);\n\t\t\tconsole.log('batchTableBinaryByteLength: ' + batchTableBinaryByteLength);\n\t\t\t*/\n\t\t\t\n\t\t\tlet pos = 28; // header length\n\t\t\tif (featureTableJSONByteLength > 0) {\n\t\t\t\tthis.featureTableJSON = JSON.parse(decoder.decode(new Uint8Array(buffer.slice(pos, pos+featureTableJSONByteLength))));\n\t\t\t\tpos += featureTableJSONByteLength;\n\t\t\t} else {\n\t\t\t\tthis.featureTableJSON = {};\n\t\t\t}\n\t\t\tthis.featureTableBinary = buffer.slice(pos, pos+featureTableBinaryByteLength);\n\t\t\tpos += featureTableBinaryByteLength;\n\t\t\tif (batchTableJsonByteLength > 0) {\n\t\t\t\tthis.batchTableJson = JSON.parse(decoder.decode(new Uint8Array(buffer.slice(pos, pos+batchTableJsonByteLength))));\n\t\t\t\tpos += batchTableJsonByteLength;\n\t\t\t} else {\n\t\t\t\tthis.batchTableJson = {};\n\t\t\t}\n\t\t\tthis.batchTableBinary = buffer.slice(pos, pos+batchTableBinaryByteLength);\n\t\t\tpos += batchTableBinaryByteLength;\n\t\t\tthis.binaryData = buffer.slice(pos);\n\t\t\treturn this;\n\t\t}\n\t}\n\t\n\tclass B3DM extends TileLoader {\n\t\tconstructor(url) {\n\t\t\tsuper(url);\n\t\t\tthis.glbData = null;\n\t\t}\n\t\tparseResponse(buffer) {\n\t\t\tsuper.parseResponse(buffer);\n\t\t\tthis.glbData = this.binaryData;\n\t\t\treturn this;\n\t\t}\n\t}\n\n\tclass PNTS extends TileLoader{\n\t\tconstructor(url) {\n\t\t\tsuper(url);\n\t\t\tthis.points = new Float32Array();\n\t\t\tthis.rgba = null;\n\t\t\tthis.rgb = null;\n\t\t}\n\t\tparseResponse(buffer) {\n\t\t\tsuper.parseResponse(buffer);\n\t\t\tif (this.featureTableJSON.POINTS_LENGTH && this.featureTableJSON.POSITION) {\n\t\t\t\tlet len = this.featureTableJSON.POINTS_LENGTH;\n\t\t\t\tlet pos = this.featureTableJSON.POSITION.byteOffset;\n\t\t\t\tthis.points = new Float32Array(this.featureTableBinary.slice(pos, pos + len * Float32Array.BYTES_PER_ELEMENT * 3));\n\t\t\t\tthis.rtc_center = this.featureTableJSON.RTC_CENTER;\n\t\t\t\tif (this.featureTableJSON.RGBA) {\n\t\t\t\t\tpos = this.featureTableJSON.RGBA.byteOffset;\n\t\t\t\t\tlet colorInts = new Uint8Array(this.featureTableBinary.slice(pos, pos + len * Uint8Array.BYTES_PER_ELEMENT * 4));\n\t\t\t\t\tlet rgba = new Float32Array(colorInts.length);\n\t\t\t\t\tfor (let i=0; i<colorInts.length; i++) {\n\t\t\t\t\t\trgba[i] = colorInts[i] / 255.0;\n\t\t\t\t\t}\n\t\t\t\t\tthis.rgba = rgba;\n\t\t\t\t} else if (this.featureTableJSON.RGB) {\n\t\t\t\t\tpos = this.featureTableJSON.RGB.byteOffset;\n\t\t\t\t\tlet colorInts = new Uint8Array(this.featureTableBinary.slice(pos, pos + len * Uint8Array.BYTES_PER_ELEMENT * 3));\n\t\t\t\t\tlet rgb = new Float32Array(colorInts.length);\n\t\t\t\t\tfor (let i=0; i<colorInts.length; i++) {\n\t\t\t\t\t\trgb[i] = colorInts[i] / 255.0;\n\t\t\t\t\t}\n\t\t\t\t\tthis.rgb = rgb;\n\t\t\t\t} else if (this.featureTableJSON.RGB565) {\n\t\t\t\t\tconsole.error('RGB565 is currently not supported in pointcloud tiles.')\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this;\n\t\t}\n\t}\n\n\n\tconst transform2mapbox = function (matrix) {\n\t\tconst min = -WEBMERCATOR_EXTENT;\n\t\tconst max = WEBMERCATOR_EXTENT;\n\t\tconst scale = 1 / (2 * WEBMERCATOR_EXTENT);\n\t\t\n\t\tlet result = matrix.slice(); // copy array\n\t\tresult[12] = (matrix[12] - min) * scale; // x translation\n\t\tresult[13] = (matrix[13] - max) * -scale; // y translation\n\t\tresult[14] = matrix[14] * scale; // z translation\n\t\t\n\t\treturn new THREE.Matrix4().fromArray(result).scale(new THREE.Vector3(scale, -scale, scale));\n\t}\n\n\tconst webmercator2mapbox = function(x, y, z) {\n\t\tconst min = -WEBMERCATOR_EXTENT;\n\t\tconst max = WEBMERCATOR_EXTENT;\n\t\tconst range = 2 * WEBMERCATOR_EXTENT;\n\t\t\n\t\treturn ([(x - min) / range, (y - max) / range * -1, z / range]);\n\t}\n\t\n\tthis.Layer = function(params) {\n\t\tif (!params) throw new Error('parameters missing for mapbox 3D tiles layer');\n\t\tif (!params.id) throw new Error('id parameter missing for mapbox 3D tiles layer');\n\t\tif (!params.url) throw new Error('url parameter missing for mapbox 3D tiles layer');\n\t\t\n\t\tthis.id = params.id,\n\t\tthis.url = params.url;\n\t\tlet styleParams = {};\n\t\tif ('color' in params) styleParams.color = params.color;\n\t\tif ('opacity' in params) styleParams.opacity = params.opacity;\n\t\tif ('pointsize' in params) styleParams.pointsize = params.pointsize;\n\n\t\tthis.loadStatus = 0;\n\t\tthis.viewProjectionMatrix = null;\n\t\t\n\t\tthis.type = 'custom';\n\t\tthis.renderingMode = '3d';\n\t\t\n\t\tthis.getCameraPosition = function() {\n\t\t\tif (!this.viewProjectionMatrix)\n\t\t\t\treturn new THREE.Vector3();\n\t\t\tlet cam = new THREE.Camera();\n\t\t\tlet rootInverse = new THREE.Matrix4().getInverse(this.rootTransform);\n\t\t\tcam.projectionMatrix.elements = this.viewProjectionMatrix;\n\t\t\tcam.projectionMatrixInverse = new THREE.Matrix4().getInverse( cam.projectionMatrix );// add since three@0.103.0\n\t\t\tlet campos = new THREE.Vector3(0, 0, 0).unproject(cam).applyMatrix4(rootInverse);\n\t\t\treturn campos;\n\t\t}\n\t\t\n\t\tthis.onAdd = function(map, gl) {\n\t\t\tthis.map = map;\n\t\t\tthis.camera = new THREE.Camera();\n\t\t\tthis.scene = new THREE.Scene();\n\t\t\tthis.rootTransform = transform2mapbox([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]); // identity matrix tranformed to mapbox scale\n\n\t\t\tlet directionalLight = new THREE.DirectionalLight(0xffffff);\n\t\t\tdirectionalLight.position.set(0, -70, 100).normalize();\n\t\t\tthis.scene.add(directionalLight);\n\n\t\t\tlet directionalLight2 = new THREE.DirectionalLight(0x999999);\n\t\t\tdirectionalLight2.position.set(0, 70, 100).normalize();\n\t\t\tthis.scene.add(directionalLight2);\n\t\t\t\n\t\t\tthis.tileset = new TileSet();\n\t\t\tlet self = this;\n\t\t\tthis.tileset.load(this.url, styleParams).then(function(){\n\t\t\t\tif (self.tileset.root.transform) {\n\t\t\t\t\tself.rootTransform = transform2mapbox(self.tileset.root.transform);\n\t\t\t\t} else {\n\t\t\t\t\tself.rootTransform = transform2mapbox([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]); // identity matrix tranformed to mapbox scale\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (self.tileset.root) {\n\t\t\t\t\tself.scene.add(self.tileset.root.totalContent);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tself.loadStatus = 1;\n\t\t\t\tfunction refresh() {\n\t\t\t\t\tlet frustum = new THREE.Frustum();\n\t\t\t\t\tfrustum.setFromMatrix(new THREE.Matrix4().multiplyMatrices(self.camera.projectionMatrix, self.camera.matrixWorldInverse));\n\t\t\t\t\tself.tileset.root.checkLoad(frustum, self.getCameraPosition());\n\t\t\t\t};\n\t\t\t\tmap.on('dragend',refresh); \n\t\t\t\tmap.on('moveend',refresh); \n\t\t\t});\n\t\t\t\n\t\t\tthis.renderer = new THREE.WebGLRenderer({\n\t\t\t\tcanvas: map.getCanvas(),\n\t\t\t\tcontext: gl\n\t\t\t});\n\t\t\tthis.renderer.autoClear = false;\n\n\n\t\t\tthis.skybox = Utils.loadSkybox(new URL('https://threejsfundamentals.org/threejs/resources/images/equirectangularmaps/tears_of_steel_bridge_2k.jpg').href);\n\n\t\t},\n\t\tthis.render = function(gl, viewProjectionMatrix) {\n\t\t\tthis.viewProjectionMatrix = viewProjectionMatrix;\n\t\t\tlet l = new THREE.Matrix4().fromArray(viewProjectionMatrix);\n\t\t\tthis.renderer.state.reset();\n\t\t\t\n\t\t\t// The root tile transform is applied to the camera while rendering\n\t\t\t// instead of to the root tile. This avoids precision errors.\n\t\t\tthis.camera.projectionMatrix = l.multiply(this.rootTransform);\n\t\t\t\n\t\t\t/*RENDER SKYBOX */\n\t\t\tthis.skybox.camera.rotation.copy(this.camera.rotation);\n\t\t\tthis.skybox.camera.fov = this.camera.fov;\n\t\t\tthis.skybox.camera.aspect = this.camera.aspect;\n\t\t\tthis.skybox.camera.updateProjectionMatrix();\n\t\t\t//this.renderer.render(this.skybox.scene, this.skybox.camera);\n\n\t\t\tthis.renderer.render(this.scene, this.camera);\t\t\n\t\t\tif (this.loadStatus == 1) { // first render after root tile is loaded\n\t\t\t\tthis.loadStatus = 2;\n\t\t\t\tlet frustum = new THREE.Frustum();\n\t\t\t\tfrustum.setFromMatrix(new THREE.Matrix4().multiplyMatrices(this.camera.projectionMatrix, this.camera.matrixWorldInverse));\n\t\t\t\tif (this.tileset.root) {\n\t\t\t\t\tthis.tileset.root.checkLoad(frustum, this.getCameraPosition());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n","import Mapbox3DTiles from './src/Mapbox3DTiles.js'\n//export default Mapbox3DTiles\nwindow.Mapbox3DTiles = new Mapbox3DTiles();\n"],"names":[],"mappings":";;;IAAO,MAAM,KAAK,CAAC;IACnB,IAAI,OAAO,UAAU,CAAC,CAAC,IAAI,EAAE;IAC7B,EAAE,IAAI,MAAM,GAAG,IAAI,KAAK,CAAC,iBAAiB,CAAC,EAAE,EAAE,MAAM,CAAC,UAAU,GAAG,MAAM,CAAC,WAAW,EAAE,CAAC,EAAE,MAAM,CAAC,CAAC;IAClG,EAAE,MAAM,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;IACzB,EAAE,IAAI,KAAK,GAAG,IAAI,KAAK,CAAC,KAAK,EAAE,CAAC;IAChC;IACA,QAAQ,MAAM,MAAM,GAAG,KAAK,CAAC,SAAS,CAAC,QAAQ,CAAC;IAChD,QAAQ,MAAM,QAAQ,GAAG,IAAI,KAAK,CAAC,cAAc,CAAC;IAClD,YAAY,cAAc,EAAE,MAAM,CAAC,cAAc;IACjD,YAAY,YAAY,EAAE,MAAM,CAAC,YAAY;IAC7C,YAAY,QAAQ,EAAE,MAAM,CAAC,QAAQ;IACrC,YAAY,UAAU,EAAE,KAAK;IAC7B,YAAY,IAAI,EAAE,KAAK,CAAC,QAAQ;IAChC,SAAS,CAAC,CAAC;AACX;IACA,QAAQ,IAAI,MAAM,GAAG,IAAI,KAAK,CAAC,aAAa,EAAE,CAAC;IAC/C,QAAQ,MAAM,CAAC,IAAI,CAAC,2GAA2G;IAC/H,YAAY,SAAS,MAAM,EAAE,OAAO,EAAE;IACtC,gBAAgB,OAAO,CAAC,SAAS,GAAG,KAAK,CAAC,YAAY,CAAC;IACvD,gBAAgB,OAAO,CAAC,SAAS,GAAG,KAAK,CAAC,YAAY,CAAC;IACvD,gBAAgB,QAAQ,CAAC,QAAQ,CAAC,SAAS,CAAC,KAAK,GAAG,OAAO,CAAC;IAC5D,aAAa,EAAE,SAAS,QAAQ,EAAE,GAAG,EAAE;IACvC;IACA,aAAa,EAAE,SAAS,KAAK,EAAE,GAAG,EAAE;IACpC,gBAAgB,OAAO,CAAC,GAAG,CAAC,mBAAmB,EAAE,GAAG,CAAC,CAAC;IACtD,aAAa;IACb,SAAS,CAAC;IACV;AACA;IACA,EAAE,IAAI,WAAW,GAAG,IAAI,KAAK,CAAC,iBAAiB,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;IAClE,EAAE,IAAI,MAAM,GAAG,IAAI,KAAK,CAAC,IAAI,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAC;AACrD;IACA,EAAE,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;AACpB;IACA;IACA,EAAE,KAAK,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC;AACjC;IACA,EAAE,OAAO,CAAC,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAE,KAAK,CAAC,CAAC;IAC5C,KAAK;IACL;;ICtCe,SAAS,aAAa,GAAG;IACxC;IACA,CAAC,MAAM,kBAAkB,GAAG,gBAAgB,CAAC;IAC7C,CAAC,MAAM,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;AAC5B,AACA;AACA;IACA,CAAC,MAAM,OAAO,CAAC;IACf,EAAE,WAAW,EAAE;IACf,GAAG,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC;IACnB,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;IACvB,GAAG,IAAI,CAAC,UAAU,GAAG,GAAG,CAAC;IACzB,GAAG,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;IAC9B,GAAG,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;IACpB,GAAG;IACH,EAAE,IAAI,CAAC,GAAG,EAAE,WAAW,EAAE;IACzB,GAAG,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;IAClB,GAAG,IAAI,YAAY,GAAG,KAAK,CAAC,WAAW,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC;IAC5D,GAAG,IAAI,IAAI,GAAG,IAAI,CAAC;IACnB,GAAG,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,KAAK;IAC3C,IAAI,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC;IACnB,MAAM,IAAI,CAAC,QAAQ,IAAI;IACvB,MAAM,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE;IACxB,OAAO,MAAM,IAAI,KAAK,CAAC,CAAC,KAAK,EAAE,QAAQ,CAAC,MAAM,CAAC,GAAG,EAAE,QAAQ,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;IAC3E,OAAO;IACP,MAAM,OAAO,QAAQ,CAAC;IACtB,MAAM,CAAC;IACP,MAAM,IAAI,CAAC,QAAQ,IAAI,QAAQ,CAAC,IAAI,EAAE,CAAC;IACvC,MAAM,IAAI,CAAC,IAAI,IAAI;IACnB,MAAM,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC;IACxC,MAAM,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC;IAChD,MAAM,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,GAAG,KAAK,CAAC;IACpE,MAAM,IAAI,CAAC,IAAI,GAAG,IAAI,YAAY,CAAC,IAAI,CAAC,IAAI,EAAE,YAAY,EAAE,WAAW,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;IAC5F,MAAM,CAAC;IACP,MAAM,IAAI,CAAC,GAAG,IAAI,OAAO,EAAE,CAAC;IAC5B,MAAM,KAAK,CAAC,KAAK,IAAI;IACrB,MAAM,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;IAC3B,MAAM,MAAM,CAAC,KAAK,CAAC,CAAC;IACpB,MAAM,CAAC,CAAC;IACR,IAAI,CAAC,CAAC;IACN,GAAG;IACH,EAAE;AACF;AACA;IACA,CAAC,MAAM,YAAY,CAAC;IACpB,EAAE,WAAW,CAAC,IAAI,EAAE,YAAY,EAAE,WAAW,EAAE,YAAY,EAAE,MAAM,EAAE;IACrE,GAAG,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;IACvB,GAAG,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;IAClC,GAAG,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC;IACpC,GAAG,IAAI,CAAC,YAAY,GAAG,IAAI,KAAK,CAAC,KAAK,EAAE,CAAC;IACzC,GAAG,IAAI,CAAC,WAAW,GAAG,IAAI,KAAK,CAAC,KAAK,EAAE,CAAC;IACxC,GAAG,IAAI,CAAC,YAAY,GAAG,IAAI,KAAK,CAAC,KAAK,EAAE,CAAC;IACzC,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;IAC3C,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;IAC5C,GAAG,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC;IAC7C,GAAG,IAAI,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC,cAAc,CAAC,GAAG,EAAE;IACvD,IAAI,IAAI,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC;IACpC,IAAI,IAAI,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACtE,IAAI,IAAI,EAAE,GAAG,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IACnE,IAAI,IAAI,EAAE,GAAG,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IACnE,IAAI,IAAI,CAAC,GAAG,GAAG,IAAI,KAAK,CAAC,IAAI,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;AACtC,IAQA,IAAI,MAAM;IACV,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;IACvB,IAAI,IAAI,CAAC,EAAE,GAAG,IAAI,CAAC;IACnB,IAAI,IAAI,CAAC,EAAE,GAAG,IAAI,CAAC;IACnB,IAAI,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC;IACpB,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;IACvB,IAAI;IACJ,GAAG,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,GAAG,YAAY,CAAC;IACxE,GAAG,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC;IAC7C,GAAG,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC;IACnC,GAAG,IAAI,IAAI,CAAC,SAAS,IAAI,CAAC,MAAM,EAAE;IAClC;IACA;IACA,IAAI,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;IACjF,IAAI;IACJ,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;IAC/B,GAAG,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;IACtB,GAAG,IAAI,IAAI,CAAC,QAAQ,EAAE;IACtB,IAAI,KAAK,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC;IAC9C,KAAK,IAAI,KAAK,GAAG,IAAI,YAAY,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,YAAY,EAAE,WAAW,EAAE,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;IACnG,KAAK,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;IAC/C,KAAK,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAC/B,KAAK;IACL,IAAI;IACJ,GAAG;IACH,EAAE,IAAI,GAAG;IACT,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC;IACnC,GAAG,IAAI,CAAC,YAAY,CAAC,OAAO,GAAG,IAAI,CAAC;IACpC,GAAG,IAAI,IAAI,CAAC,MAAM,EAAE;IACpB,IAAI,OAAO;IACX,IAAI;IACJ,GAAG,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;IACtB,GAAG,IAAI,IAAI,GAAG,IAAI,CAAC;IACnB,GAAG,IAAI,IAAI,CAAC,OAAO,EAAE;IACrB,IAAI,IAAI,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC;IACrE,IAAI,IAAI,CAAC,GAAG,EAAE,OAAO;IACrB,IAAI,IAAI,GAAG,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,MAAM;IAClC,KAAK,GAAG,GAAG,IAAI,CAAC,YAAY,GAAG,GAAG,CAAC;IACnC,IAAI,IAAI,IAAI,GAAG,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;IAC7B,IAAI,IAAI,IAAI,IAAI,MAAM,EAAE;IACxB;IACA,KAAK,IAAI,OAAO,GAAG,IAAI,OAAO,EAAE,CAAC;IACjC,KAAK,OAAO,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,UAAU;IACxD,MAAM,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;IACvC,MAAM,IAAI,OAAO,CAAC,IAAI,EAAE;IACxB,OAAO,IAAI,OAAO,CAAC,IAAI,CAAC,SAAS,EAAE;IACnC;IACA;IACA;IACA;IACA,QAAQ,OAAO,CAAC,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;IACrG,QAAQ;IACR,OAAO,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;IACxD,OAAO;IACP,MAAM,CAAC,CAAC;IACR,KAAK,MAAM,IAAI,IAAI,IAAI,MAAM,EAAE;IAC/B,KAAK,IAAI,MAAM,GAAG,IAAI,KAAK,CAAC,UAAU,EAAE,CAAC;IACzC,KAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,GAAG,CAAC,CAAC;IAC9B,KAAK,IAAI,OAAO,GAAG,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC,gBAAgB,CAAC,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;IACjG,KAAK,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;IAC3C,KAAK,IAAI,CAAC,IAAI,EAAE;IAChB,OAAO,IAAI,CAAC,CAAC,IAAI,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,OAAO,EAAE,IAAI,CAAC,YAAY,EAAE,SAAS,IAAI,EAAE;IAC3E,QAAQ,IAAI,IAAI,CAAC,WAAW,CAAC,KAAK,IAAI,IAAI,IAAI,IAAI,CAAC,WAAW,CAAC,OAAO,IAAI,IAAI,EAAE;IAChF,SAAS,IAAI,KAAK,GAAG,IAAI,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;IAC7D,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,KAAK,IAAI;IACtC,UAAU,IAAI,KAAK,YAAY,KAAK,CAAC,IAAI,EAAE;IAC3C,WAAW,IAAI,IAAI,CAAC,WAAW,CAAC,KAAK,IAAI,IAAI;IAC7C,YAAY,KAAK,CAAC,QAAQ,CAAC,KAAK,GAAG,KAAK,CAAC;IACzC,WAAW,IAAI,IAAI,CAAC,WAAW,CAAC,OAAO,IAAI,IAAI,EAAE;IACjD,YAAY,KAAK,CAAC,QAAQ,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC;IAC9D,YAAY,KAAK,CAAC,QAAQ,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,GAAG,GAAG,IAAI,GAAG,KAAK,CAAC;IACvF,YAAY;IACZ,WAAW;IACX,UAAU,CAAC,CAAC;IACZ,SAAS;IACT;IACA;IACA;IACA;IACA;IACA,QAAQ,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IACzC,QAAQ,EAAE,SAAS,CAAC,EAAE;IACtB,QAAQ,MAAM,IAAI,KAAK,CAAC,sBAAsB,GAAG,CAAC,CAAC,CAAC;IACpD,QAAQ,CAAC;IACT,QAAO;IACP,KAAK,MAAM,IAAI,IAAI,IAAI,MAAM,EAAE;IAC/B,KAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,GAAG,CAAC,CAAC;IAC9B,KAAK,IAAI,CAAC,IAAI,EAAE;IAChB,OAAO,IAAI,CAAC,CAAC,IAAI;IACjB,OAAO,IAAI,QAAQ,GAAG,IAAI,KAAK,CAAC,cAAc,EAAE,CAAC;IACjD,OAAO,QAAQ,CAAC,YAAY,CAAC,UAAU,EAAE,IAAI,KAAK,CAAC,sBAAsB,CAAC,CAAC,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,CAAC;IACxF,OAAO,IAAI,QAAQ,GAAG,IAAI,KAAK,CAAC,cAAc,EAAE,CAAC;IACjD,OAAO,QAAQ,CAAC,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC,SAAS,IAAI,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC,SAAS,GAAG,GAAG,CAAC;IAC7F,OAAO,IAAI,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE;IACnC,QAAQ,QAAQ,CAAC,YAAY,GAAG,KAAK,CAAC,QAAQ,CAAC;IAC/C,QAAQ,QAAQ,CAAC,KAAK,GAAG,IAAI,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;IACjE,QAAQ,QAAQ,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,IAAI,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,GAAG,CAAC;IAC7F,QAAQ,MAAM,IAAI,CAAC,CAAC,IAAI,EAAE;IAC1B,QAAQ,QAAQ,CAAC,YAAY,CAAC,OAAO,EAAE,IAAI,KAAK,CAAC,sBAAsB,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC;IACpF,QAAQ,QAAQ,CAAC,YAAY,GAAG,KAAK,CAAC,YAAY,CAAC;IACnD,QAAQ,MAAM,IAAI,CAAC,CAAC,GAAG,EAAE;IACzB,QAAQ,QAAQ,CAAC,YAAY,CAAC,OAAO,EAAE,IAAI,KAAK,CAAC,sBAAsB,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC;IACnF,QAAQ,QAAQ,CAAC,YAAY,GAAG,KAAK,CAAC,YAAY,CAAC;IACnD,QAAQ;IACR,OAAO,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,KAAK,CAAC,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,CAAC,CAAC;IACpE,OAAO,IAAI,CAAC,CAAC,UAAU,EAAE;IACzB,QAAQ,IAAI,CAAC,GAAG,CAAC,CAAC,UAAU,CAAC;IAC7B,QAAQ,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAC5F,QAAQ;IACR,OAAO,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,KAAK,CAAC,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,CAAC,CAAC;IACpE,OAAO,CAAC,CAAC;IACT,KAAK,MAAM,IAAI,IAAI,IAAI,MAAM,EAAE;IAC/B,KAAK,MAAM,IAAI,KAAK,CAAC,gCAAgC,CAAC,CAAC;IACvD,KAAK,MAAM,IAAI,IAAI,IAAI,MAAM,EAAE;IAC/B,KAAK,MAAM,IAAI,KAAK,CAAC,gCAAgC,CAAC,CAAC;IACvD,KAAK,MAAM;IACX,KAAK,MAAM,IAAI,KAAK,CAAC,qBAAqB,GAAG,IAAI,CAAC,CAAC;IACnD,KAAK;IACL,IAAI;IACJ,GAAG;IACH,EAAE,MAAM,CAAC,eAAe,EAAE;IAC1B,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,KAAK,CAAC;IACpC,GAAG,IAAI,eAAe,EAAE;IACxB,IAAI,IAAI,CAAC,YAAY,CAAC,OAAO,GAAG,KAAK,CAAC;IACtC,IAAI,OAAO;IACX,IAAI,IAAI,CAAC,YAAY,CAAC,OAAO,GAAG,IAAI,CAAC;IACrC,IAAI;IACJ;IACA,GAAG;IACH,EAAE,SAAS,CAAC,OAAO,EAAE,cAAc,EAAE;IACrC;IACA,GAAG,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE;IACzC,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;IACtB,IAAI,OAAO;IACX,IAAI;IACJ;IACA,GAAG,IAAI,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,eAAe,CAAC,cAAc,CAAC,CAAC;AACvD;IACA;IACA;IACA,GAAG,IAAI,IAAI,CAAC,cAAc,GAAG,GAAG,IAAI,IAAI,GAAG,IAAI,CAAC,cAAc,GAAG,IAAI,EAAE;IACvE,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;IACtB,IAAI,OAAO;IACX,IAAI;IACJ;IACA;IACA,GAAG,IAAI,IAAI,CAAC,MAAM,IAAI,SAAS,IAAI,IAAI,GAAG,IAAI,CAAC,cAAc,GAAG,IAAI,EAAE;IACtE,IAAI,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IACvB,IAAI,MAAM;IACV,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC;IAChB,IAAI;AACJ;IACA;IACA,GAAG,KAAK,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;IAC9C,IAAI,IAAI,IAAI,GAAG,IAAI,CAAC,cAAc,GAAG,IAAI,EAAE;IAC3C,KAAK,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,OAAO,EAAE,cAAc,CAAC,CAAC;IACzD,KAAK,MAAM;IACX,KAAK,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;IACnC,KAAK;IACL,IAAI;IACJ;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA,GAAG;IACH,EAAE;AACF;IACA,CAAC,MAAM,UAAU,CAAC;IAClB;IACA;IACA;IACA,EAAE,WAAW,CAAC,GAAG,EAAE;IACnB,GAAG,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;IAClB,GAAG,IAAI,CAAC,IAAI,GAAG,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;IAC7B,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;IACvB,GAAG,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;IAC1B,GAAG,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC;IAChC,GAAG,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC;IAClC,GAAG,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;IAC9B,GAAG,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC;IAChC,GAAG,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;IAC1B,GAAG;IACH,EAAE,IAAI,GAAG;IACT,GAAG,IAAI,IAAI,GAAG,IAAI,CAAC;IACnB,GAAG,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,KAAK;IAC3C,IAAI,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC;IACnB,MAAM,IAAI,CAAC,QAAQ,IAAI;IACvB,MAAM,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE;IACxB,OAAO,MAAM,IAAI,KAAK,CAAC,CAAC,KAAK,EAAE,QAAQ,CAAC,MAAM,CAAC,GAAG,EAAE,QAAQ,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;IAC3E,OAAO;IACP,MAAM,OAAO,QAAQ,CAAC;IACtB,MAAM,CAAC;IACP,MAAM,IAAI,CAAC,QAAQ,IAAI,QAAQ,CAAC,WAAW,EAAE,CAAC;IAC9C,MAAM,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;IAChD,MAAM,IAAI,CAAC,GAAG,IAAI,OAAO,CAAC,GAAG,CAAC,CAAC;IAC/B,MAAM,KAAK,CAAC,KAAK,IAAI;IACrB,MAAM,MAAM,CAAC,KAAK,CAAC,CAAC;IACpB,MAAM,CAAC,CAAC;IACR,IAAI,CAAC,CAAC;IACN,GAAG;IACH,EAAE,aAAa,CAAC,MAAM,EAAE;IACxB,GAAG,IAAI,MAAM,GAAG,IAAI,WAAW,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;IACrD,GAAG,IAAI,OAAO,GAAG,IAAI,WAAW,EAAE,CAAC;IACnC,GAAG,IAAI,KAAK,GAAG,OAAO,CAAC,MAAM,CAAC,IAAI,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;IAClE,GAAG,IAAI,KAAK,IAAI,IAAI,CAAC,IAAI,EAAE;IAC3B,IAAI,MAAM,IAAI,KAAK,CAAC,CAAC,gCAAgC,EAAE,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;IAC1F,IAAI;IACJ,GAAG,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;IAC5B,GAAG,IAAI,CAAC,UAAU,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;IAC/B,GAAG,IAAI,0BAA0B,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;IAC9C,GAAG,IAAI,4BAA4B,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;IAChD,GAAG,IAAI,wBAAwB,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;IAC5C,GAAG,IAAI,0BAA0B,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;IAC9C;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA,GAAG,IAAI,GAAG,GAAG,EAAE,CAAC;IAChB,GAAG,IAAI,0BAA0B,GAAG,CAAC,EAAE;IACvC,IAAI,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,EAAE,GAAG,CAAC,0BAA0B,CAAC,CAAC,CAAC,CAAC,CAAC;IAC1H,IAAI,GAAG,IAAI,0BAA0B,CAAC;IACtC,IAAI,MAAM;IACV,IAAI,IAAI,CAAC,gBAAgB,GAAG,EAAE,CAAC;IAC/B,IAAI;IACJ,GAAG,IAAI,CAAC,kBAAkB,GAAG,MAAM,CAAC,KAAK,CAAC,GAAG,EAAE,GAAG,CAAC,4BAA4B,CAAC,CAAC;IACjF,GAAG,GAAG,IAAI,4BAA4B,CAAC;IACvC,GAAG,IAAI,wBAAwB,GAAG,CAAC,EAAE;IACrC,IAAI,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,EAAE,GAAG,CAAC,wBAAwB,CAAC,CAAC,CAAC,CAAC,CAAC;IACtH,IAAI,GAAG,IAAI,wBAAwB,CAAC;IACpC,IAAI,MAAM;IACV,IAAI,IAAI,CAAC,cAAc,GAAG,EAAE,CAAC;IAC7B,IAAI;IACJ,GAAG,IAAI,CAAC,gBAAgB,GAAG,MAAM,CAAC,KAAK,CAAC,GAAG,EAAE,GAAG,CAAC,0BAA0B,CAAC,CAAC;IAC7E,GAAG,GAAG,IAAI,0BAA0B,CAAC;IACrC,GAAG,IAAI,CAAC,UAAU,GAAG,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;IACvC,GAAG,OAAO,IAAI,CAAC;IACf,GAAG;IACH,EAAE;IACF;IACA,CAAC,MAAM,IAAI,SAAS,UAAU,CAAC;IAC/B,EAAE,WAAW,CAAC,GAAG,EAAE;IACnB,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC;IACd,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;IACvB,GAAG;IACH,EAAE,aAAa,CAAC,MAAM,EAAE;IACxB,GAAG,KAAK,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;IAC/B,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC;IAClC,GAAG,OAAO,IAAI,CAAC;IACf,GAAG;IACH,EAAE;AACF;IACA,CAAC,MAAM,IAAI,SAAS,UAAU;IAC9B,EAAE,WAAW,CAAC,GAAG,EAAE;IACnB,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC;IACd,GAAG,IAAI,CAAC,MAAM,GAAG,IAAI,YAAY,EAAE,CAAC;IACpC,GAAG,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;IACpB,GAAG,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC;IACnB,GAAG;IACH,EAAE,aAAa,CAAC,MAAM,EAAE;IACxB,GAAG,KAAK,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;IAC/B,GAAG,IAAI,IAAI,CAAC,gBAAgB,CAAC,aAAa,IAAI,IAAI,CAAC,gBAAgB,CAAC,QAAQ,EAAE;IAC9E,IAAI,IAAI,GAAG,GAAG,IAAI,CAAC,gBAAgB,CAAC,aAAa,CAAC;IAClD,IAAI,IAAI,GAAG,GAAG,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,UAAU,CAAC;IACxD,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,YAAY,CAAC,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,GAAG,YAAY,CAAC,iBAAiB,GAAG,CAAC,CAAC,CAAC,CAAC;IACvH,IAAI,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,gBAAgB,CAAC,UAAU,CAAC;IACvD,IAAI,IAAI,IAAI,CAAC,gBAAgB,CAAC,IAAI,EAAE;IACpC,KAAK,GAAG,GAAG,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,UAAU,CAAC;IACjD,KAAK,IAAI,SAAS,GAAG,IAAI,UAAU,CAAC,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,GAAG,UAAU,CAAC,iBAAiB,GAAG,CAAC,CAAC,CAAC,CAAC;IACtH,KAAK,IAAI,IAAI,GAAG,IAAI,YAAY,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;IACnD,KAAK,KAAK,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;IAC5C,MAAM,IAAI,CAAC,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC;IACrC,MAAM;IACN,KAAK,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;IACtB,KAAK,MAAM,IAAI,IAAI,CAAC,gBAAgB,CAAC,GAAG,EAAE;IAC1C,KAAK,GAAG,GAAG,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,UAAU,CAAC;IAChD,KAAK,IAAI,SAAS,GAAG,IAAI,UAAU,CAAC,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,GAAG,UAAU,CAAC,iBAAiB,GAAG,CAAC,CAAC,CAAC,CAAC;IACtH,KAAK,IAAI,GAAG,GAAG,IAAI,YAAY,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;IAClD,KAAK,KAAK,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;IAC5C,MAAM,GAAG,CAAC,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC;IACpC,MAAM;IACN,KAAK,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;IACpB,KAAK,MAAM,IAAI,IAAI,CAAC,gBAAgB,CAAC,MAAM,EAAE;IAC7C,KAAK,OAAO,CAAC,KAAK,CAAC,wDAAwD,EAAC;IAC5E,KAAK;IACL,IAAI;IACJ,GAAG,OAAO,IAAI,CAAC;IACf,GAAG;IACH,EAAE;AACF;AACA;IACA,CAAC,MAAM,gBAAgB,GAAG,UAAU,MAAM,EAAE;IAC5C,EAAE,MAAM,GAAG,GAAG,CAAC,kBAAkB,CAAC;IAClC,EAAE,MAAM,GAAG,GAAG,kBAAkB,CAAC;IACjC,EAAE,MAAM,KAAK,GAAG,CAAC,IAAI,CAAC,GAAG,kBAAkB,CAAC,CAAC;IAC7C;IACA,EAAE,IAAI,MAAM,GAAG,MAAM,CAAC,KAAK,EAAE,CAAC;IAC9B,EAAE,MAAM,CAAC,EAAE,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,GAAG,GAAG,IAAI,KAAK,CAAC;IAC1C,EAAE,MAAM,CAAC,EAAE,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC;IAC3C,EAAE,MAAM,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC;IAClC;IACA,EAAE,OAAO,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,KAAK,CAAC,IAAI,KAAK,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC;IAC9F,GAAE;AACF,IAQA;IACA,CAAC,IAAI,CAAC,KAAK,GAAG,SAAS,MAAM,EAAE;IAC/B,EAAE,IAAI,CAAC,MAAM,EAAE,MAAM,IAAI,KAAK,CAAC,8CAA8C,CAAC,CAAC;IAC/E,EAAE,IAAI,CAAC,MAAM,CAAC,EAAE,EAAE,MAAM,IAAI,KAAK,CAAC,gDAAgD,CAAC,CAAC;IACpF,EAAE,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,MAAM,IAAI,KAAK,CAAC,iDAAiD,CAAC,CAAC;IACtF;IACA,EAAE,IAAI,CAAC,EAAE,GAAG,MAAM,CAAC,EAAE;IACrB,EAAE,IAAI,CAAC,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC;IACxB,EAAE,IAAI,WAAW,GAAG,EAAE,CAAC;IACvB,EAAE,IAAI,OAAO,IAAI,MAAM,EAAE,WAAW,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;IAC1D,EAAE,IAAI,SAAS,IAAI,MAAM,EAAE,WAAW,CAAC,OAAO,GAAG,MAAM,CAAC,OAAO,CAAC;IAChE,EAAE,IAAI,WAAW,IAAI,MAAM,EAAE,WAAW,CAAC,SAAS,GAAG,MAAM,CAAC,SAAS,CAAC;AACtE;IACA,EAAE,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;IACtB,EAAE,IAAI,CAAC,oBAAoB,GAAG,IAAI,CAAC;IACnC;IACA,EAAE,IAAI,CAAC,IAAI,GAAG,QAAQ,CAAC;IACvB,EAAE,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;IAC5B;IACA,EAAE,IAAI,CAAC,iBAAiB,GAAG,WAAW;IACtC,GAAG,IAAI,CAAC,IAAI,CAAC,oBAAoB;IACjC,IAAI,OAAO,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC;IAC/B,GAAG,IAAI,GAAG,GAAG,IAAI,KAAK,CAAC,MAAM,EAAE,CAAC;IAChC,GAAG,IAAI,WAAW,GAAG,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC,UAAU,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;IACxE,GAAG,GAAG,CAAC,gBAAgB,CAAC,QAAQ,GAAG,IAAI,CAAC,oBAAoB,CAAC;IAC7D,GAAG,GAAG,CAAC,uBAAuB,GAAG,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC,UAAU,EAAE,GAAG,CAAC,gBAAgB,EAAE,CAAC;IACxF,GAAG,IAAI,MAAM,GAAG,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,YAAY,CAAC,WAAW,CAAC,CAAC;IACpF,GAAG,OAAO,MAAM,CAAC;IACjB,IAAG;IACH;IACA,EAAE,IAAI,CAAC,KAAK,GAAG,SAAS,GAAG,EAAE,EAAE,EAAE;IACjC,GAAG,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;IAClB,GAAG,IAAI,CAAC,MAAM,GAAG,IAAI,KAAK,CAAC,MAAM,EAAE,CAAC;IACpC,GAAG,IAAI,CAAC,KAAK,GAAG,IAAI,KAAK,CAAC,KAAK,EAAE,CAAC;IAClC,GAAG,IAAI,CAAC,aAAa,GAAG,gBAAgB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAC5E;IACA,GAAG,IAAI,gBAAgB,GAAG,IAAI,KAAK,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC;IAC/D,GAAG,gBAAgB,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC,SAAS,EAAE,CAAC;IAC1D,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;AACpC;IACA,GAAG,IAAI,iBAAiB,GAAG,IAAI,KAAK,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC;IAChE,GAAG,iBAAiB,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,CAAC,SAAS,EAAE,CAAC;IAC1D,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;IACrC;IACA,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,OAAO,EAAE,CAAC;IAChC,GAAG,IAAI,IAAI,GAAG,IAAI,CAAC;IACnB,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,WAAW,CAAC,CAAC,IAAI,CAAC,UAAU;IAC3D,IAAI,IAAI,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,EAAE;IACrC,KAAK,IAAI,CAAC,aAAa,GAAG,gBAAgB,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;IACxE,KAAK,MAAM;IACX,KAAK,IAAI,CAAC,aAAa,GAAG,gBAAgB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAC9E,KAAK;IACL;IACA,IAAI,IAAI,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE;IAC3B,KAAK,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;IACpD,KAAK;IACL;IACA,IAAI,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;IACxB,IAAI,SAAS,OAAO,GAAG;IACvB,KAAK,IAAI,OAAO,GAAG,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC;IACvC,KAAK,OAAO,CAAC,aAAa,CAAC,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC,gBAAgB,CAAC,IAAI,CAAC,MAAM,CAAC,gBAAgB,EAAE,IAAI,CAAC,MAAM,CAAC,kBAAkB,CAAC,CAAC,CAAC;IAC/H,KAAK,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,IAAI,CAAC,iBAAiB,EAAE,CAAC,CAAC;IACpE,KAAK,AACL,IAAI,GAAG,CAAC,EAAE,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;IAC9B,IAAI,GAAG,CAAC,EAAE,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;IAC9B,IAAI,CAAC,CAAC;IACN;IACA,GAAG,IAAI,CAAC,QAAQ,GAAG,IAAI,KAAK,CAAC,aAAa,CAAC;IAC3C,IAAI,MAAM,EAAE,GAAG,CAAC,SAAS,EAAE;IAC3B,IAAI,OAAO,EAAE,EAAE;IACf,IAAI,CAAC,CAAC;IACN,GAAG,IAAI,CAAC,QAAQ,CAAC,SAAS,GAAG,KAAK,CAAC;AACnC;AACA;IACA,GAAG,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC,UAAU,CAAC,IAAI,GAAG,CAAC,2GAA2G,CAAC,CAAC,IAAI,CAAC,CAAC;AAC7J;IACA,GAAG;IACH,EAAE,IAAI,CAAC,MAAM,GAAG,SAAS,EAAE,EAAE,oBAAoB,EAAE;IACnD,GAAG,IAAI,CAAC,oBAAoB,GAAG,oBAAoB,CAAC;IACpD,GAAG,IAAI,CAAC,GAAG,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC,SAAS,CAAC,oBAAoB,CAAC,CAAC;IAC/D,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;IAC/B;IACA;IACA;IACA,GAAG,IAAI,CAAC,MAAM,CAAC,gBAAgB,GAAG,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;IACjE;IACA;IACA,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;IAC1D,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC;IAC5C,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC;IAClD,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,sBAAsB,EAAE,CAAC;IAC/C;AACA;IACA,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;IACjD,GAAG,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;IAC7B,IAAI,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;IACxB,IAAI,IAAI,OAAO,GAAG,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC;IACtC,IAAI,OAAO,CAAC,aAAa,CAAC,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC,gBAAgB,CAAC,IAAI,CAAC,MAAM,CAAC,gBAAgB,EAAE,IAAI,CAAC,MAAM,CAAC,kBAAkB,CAAC,CAAC,CAAC;IAC9H,IAAI,IAAI,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE;IAC3B,KAAK,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,IAAI,CAAC,iBAAiB,EAAE,CAAC,CAAC;IACpE,KAAK;IACL,IAAI;IACJ,IAAG;IACH,GAAE;IACF,CAAC;;IC1fD;IACA,MAAM,CAAC,aAAa,GAAG,IAAI,aAAa,EAAE,CAAC;;;;"}